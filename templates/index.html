<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Secure Messenger Automation</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
* { font-family: 'Inter', sans-serif; transition: all 0.3s ease; }
.gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
.card-hover { transition: transform 0.3s ease, box-shadow 0.3s ease; }
.card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
.slide-in { animation: slideIn 0.6s ease-out; }
.fade-in { animation: fadeIn 0.8s ease-in; }
.shake { animation: shake 0.5s; }
@keyframes slideIn { from {opacity:0; transform:translateY(30px);} to {opacity:1; transform:translateY(0);} }
@keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
@keyframes shake { 0%,100%{transform:translateX(0);} 25%{transform:translateX(-10px);} 75%{transform:translateX(10px);} }
.success-pulse { animation: successPulse 2s infinite; }
@keyframes successPulse { 0% {box-shadow:0 0 0 0 rgba(72,187,120,0.4);} 70% {box-shadow:0 0 0 10px rgba(72,187,120,0);} 100% {box-shadow:0 0 0 0 rgba(72,187,120,0);} }
</style>
</head>
<body class="min-h-screen gradient-bg">
<div class="container mx-auto px-4 py-8">

<!-- Header -->
<div class="text-center mb-12 fade-in">
<div class="inline-block p-4 bg-white rounded-full shadow-lg mb-4">
<i class="fas fa-shield-alt text-4xl text-blue-600"></i>
</div>
<h1 class="text-4xl font-bold text-white mb-2">Secure Messenger Automation</h1>
<p class="text-blue-100 text-lg">Professional messaging platform with enterprise-grade security</p>
</div>

<!-- Login Section -->
<div id="loginSection" class="bg-white rounded-2xl shadow-2xl p-8 mb-8 slide-in max-w-md mx-auto">
<div class="text-center mb-6">
<h2 class="text-2xl font-semibold text-gray-800 mb-2">Secure Authentication</h2>
<p class="text-gray-600">Enter credentials to continue</p>
</div>
<form id="loginForm" class="space-y-6">
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
<input type="text" id="username" class="w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="Username" required>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
<input type="password" id="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="Password" required>
</div>
<button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg font-semibold">
<i class="fas fa-lock mr-2"></i>Login
</button>
</form>
</div>

<!-- Config Section -->
<div id="configSection" class="hidden bg-white rounded-2xl shadow-2xl p-8 mb-8 max-w-2xl mx-auto card-hover">
<div class="text-center mb-6">
<h2 class="text-2xl font-semibold text-gray-800 mb-2">Messaging Configuration</h2>
<p class="text-gray-600">Enter tokens, messages, and chat ID</p>
</div>
<form id="configForm" class="space-y-6">
<div>
<label class="block text-sm font-medium text-gray-700 mb-2"><i class="fas fa-key mr-2 text-blue-500"></i>Tokens</label>
<textarea id="tokens" class="w-full px-4 py-3 border border-gray-300 rounded-lg h-32" placeholder="One token per line" required></textarea>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2"><i class="fas fa-comment mr-2 text-green-500"></i>Messages</label>
<textarea id="messages" class="w-full px-4 py-3 border border-gray-300 rounded-lg h-32" placeholder="One message per line" required></textarea>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2"><i class="fas fa-users mr-2 text-purple-500"></i>Chat ID</label>
<input type="text" id="chatId" class="w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="Chat/Group ID" required>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-2"><i class="fas fa-clock mr-2 text-yellow-500"></i>Interval (seconds)</label>
<input type="number" id="interval" min="1" class="w-full px-4 py-3 border border-gray-300 rounded-lg" placeholder="Interval" required>
</div>
<button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white py-3 px-6 rounded-lg font-semibold">
<i class="fas fa-paper-plane mr-2"></i>Start
</button>
</form>
</div>

<!-- Control Panel -->
<div id="controlPanel" class="hidden bg-white rounded-2xl shadow-2xl p-8 mb-8 max-w-2xl mx-auto card-hover">
<div class="text-center mb-6">
<h2 class="text-2xl font-semibold text-gray-800 mb-2">Control Panel</h2>
<p class="text-green-600 font-medium success-pulse p-2 rounded-lg"><i class="fas fa-check-circle mr-2"></i>Messages are being sent</p>
</div>
<div class="mb-6">
<h3 class="text-lg font-semibold text-gray-800 mb-2"><i class="fas fa-id-card mr-2 text-blue-500"></i>Task ID</h3>
<div class="flex items-center justify-between bg-white p-4 rounded border">
<code id="taskIdDisplay" class="text-lg font-mono text-blue-600"></code>
<button onclick="copyTaskId()" class="bg-blue-100 hover:bg-blue-200 text-blue-700 px-4 py-2 rounded text-sm"><i class="fas fa-copy mr-1"></i>Copy</button>
</div>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
<div class="bg-blue-50 p-4 rounded-lg">
<p>Messages Sent: <span id="messagesSent" class="font-semibold">0</span></p>
<p>Active Tokens: <span id="activeTokens" class="font-semibold">0</span></p>
</div>
<div class="bg-green-50 p-4 rounded-lg">
<p>Interval: <span id="currentInterval" class="font-semibold">-</span>s</p>
<p>Status: <span class="font-semibold text-green-600">Active</span></p>
</div>
</div>
<div class="text-center">
<h3 class="text-lg font-semibold text-gray-800 mb-4"><i class="fas fa-stop-circle mr-2 text-red-500"></i>Stop Task</h3>
<div class="flex space-x-4 justify-center">
<input type="text" id="stopTaskId" class="px-4 py-2 border border-gray-300 rounded-lg w-64" placeholder="Enter Task ID">
<button onclick="stopMessages()" class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg font-semibold"><i class="fas fa-stop mr-2"></i>Stop</button>
</div>
</div>
</div>

</div>

<script>
const VALID_USERNAME="admin",VALID_PASSWORD="secure123";
let currentTaskId=null,messageInterval=null,messagesSent=0;

document.getElementById('loginForm').addEventListener('submit',function(e){
    e.preventDefault();
    const username=document.getElementById('username').value;
    const password=document.getElementById('password').value;
    if(username===VALID_USERNAME && password===VALID_PASSWORD){
        document.getElementById('loginSection').classList.add('hidden');
        document.getElementById('configSection').classList.remove('hidden');
        document.getElementById('configSection').classList.add('slide-in');
    }else{alert('Invalid credentials');}
});

document.getElementById('configForm').addEventListener('submit',async function(e){
    e.preventDefault();
    const tokens=document.getElementById('tokens').value.split('\n').filter(t=>t.trim());
    const messages=document.getElementById('messages').value.split('\n').filter(m=>m.trim());
    const chatId=document.getElementById('chatId').value;
    const interval=parseInt(document.getElementById('interval').value);

    if(!tokens.length || !messages.length || !chatId || interval<1){alert('Fill all fields');return;}
    
    const res=await fetch('/start_task',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({tokens,messages,chatId,interval})});
    const data=await res.json();

    if(data.success){
        currentTaskId=data.taskId;
        document.getElementById('configSection').classList.add('hidden');
        document.getElementById('controlPanel').classList.remove('hidden');
        document.getElementById('taskIdDisplay').textContent=currentTaskId;
        document.getElementById('activeTokens').textContent=tokens.length;
        document.getElementById('currentInterval').textContent=interval;

        if(data.invalid_tokens_initially && data.invalid_tokens_initially.length){
            alert("These tokens failed immediately:\n"+data.invalid_tokens_initially.join("\n"));
        }

        messageInterval=setInterval(async()=>{
            const status=await fetch(`/status/${currentTaskId}`).then(r=>r.json());
            document.getElementById('messagesSent').textContent=status.messages_sent || 0;
        },1000);
    }else{alert(data.error);}
});

function stopMessages(){
    const taskId=document.getElementById('stopTaskId').value;
    fetch('/stop_task',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({taskId})})
    .then(r=>r.json())
    .then(data=>{
        if(data.success){
            clearInterval(messageInterval);
            document.getElementById('controlPanel').classList.add('hidden');
            document.getElementById('configSection').classList.remove('hidden');
            document.getElementById('tokens').value='';
            document.getElementById('messages').value='';
            document.getElementById('chatId').value='';
            document.getElementById('interval').value='';
            messagesSent=0;
        }else{alert(data.error);}
    });
}

function copyTaskId(){
    const taskIdText=document.getElementById('taskIdDisplay').textContent;
    navigator.clipboard.writeText(taskIdText).then(()=>alert('Task ID copied!'));
}
</script>
</body>
                      </html>
